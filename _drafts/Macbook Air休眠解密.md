买了部2013款Macbook Air给女朋友，13寸高配，内存加到8G。买的时候就冲着12小时All Day Battery Life去的。这么轻薄的一部笔记本，能用一天的电池，对于不玩游戏的人来说简直是神物啊，减轻了N吨背包负重


官网订的港行，尼玛从上海寄过来竟然用了3天，DHL敢再给力点吗…………
到手后迫不及待地开箱，忍不住再次感叹，那个轻啊、那个薄啊……LZ常年背惯了MD101  觉得Air真的是跟没重量一样


开机，装好要用的软件什么的，设置好各种东西，然后把hibernatemode调到0，然后就放包里合盖睡眠。


然后悲剧发生了…………第二天早上起床的时候   发现Air的风扇在全速运转，机身非常热，电量直接从100%跌到0……


开始LZ还以为是偶然事件，之前在威锋上也看到别的锋友遇到过。然后晚上用完再次合盖睡眠，然后……就没有然后了……电池又一次从满电直接变成无法开机…………


这样的情况一次又一次地发生，只要是处在睡眠模式，无论有没有开PowerNap、有没有连网络、有没有开任何软件、电池有多少电，都会在6、7个小时内耗完所有电量。


就跟Air根本就没有睡眠一样，虽然合上了屏幕，但是Air根本就没有进入睡眠，依然是全速运转。我的MD101睡眠一晚上也只是2%-3%的电，新Air不至于这么不给力吧，不是说30天超长待机吗……



重装系统、更改hibernatemode、调电源设置、重置SMC  NVRAM、问客服……能想到的方法全都试过，依然无解………


难道我的Air就注定不能进睡眠模式？难道我只能跟apple换机？


就在我已经准备去跟apple换机的时候，突然想到了一样东西——pmset——Mac OS X的电源管理系统，通过pmset可以更改Mac所有的电源设置，为什么不在这里折腾下呢？鼓搞了一个上午，然后再经过一个晚上的检验，LZ终于解决了这个问题！！！！！





说了那么多废话，现在开始入正题！！

这个问题的缘由LZ估计是更改了hibernatemode，因为手动更改了睡眠模式之后，跟系统原有的其他电源设置有冲突，所以造成Air无法正常进入睡眠状态。

为了方便部分锋友，先科普下Mac的睡眠模式，老鸟请自觉跳过…………


睡眠模式—hibernatemode—也就是Mac在睡眠模式下面的工作方式，目前主要有3种。
hibernatemode 0：睡眠时内存保持供电，其他部件断电，内存数据不写入硬盘。优点是可以快速唤醒、快速睡眠，因为内存保持供电，无论是唤醒还是进入睡眠都是1秒内的事情；节省SSD空间和寿命，因为内存数据不写入硬盘，所以硬盘里不会有内存镜像，也不会缩短SSD寿命。但是如果在睡眠的过程中电池没电的话，Mac会丢失所有内存种的数据，数据安全性不是很高。


hibernatemode 1：睡眠时内存数据写入硬盘，写入完成后电脑所有部件都断电，唤醒时从硬盘读出内存镜像。优点是省电，跟关机的耗电一样，因为所有部件都已经停止工作，也不怕电池没电会丢失内存数据。但是缺点也很明显，进入睡眠和唤醒需要的时间长，对于机械硬盘的Mac尤其明显，通常都要转菊花十几圈。对于SSD的Mac则会占用硬盘空间，因为硬盘上有跟内存同样大小的内存镜像，也会缩短SSD寿命。


hibernatemode 3：0和1的结合，睡眠时内存数据写入硬盘，同时保持内存供电。这个模式也叫Safe Sleep，是Mac的默认睡眠模式。


因为Air的SSD只有256G，而且SSD寿命也有限，每睡眠一次都要往SSD写入8G的数据还是挺吓人的，所以LZ还是建议用SSD的锋友都选择hibernatemode 0(除非你对数据安全性要求特别高)。


更改hibernatemode很简单，打开“终端”，输入: sudo pmset -a hibernatemode 0

然后输入密码，注意输入密码的过程中不会显示*。

然后到/var/vm去把sleepimage删掉。再随便找一个体积比较小的文档把文件名改成sleepimage，没有后缀名的哦。放到/var/vm里，再按command+i打开简介，勾上“已锁定”。按理说，只要hibernatemode改成0，然后把sleepimage删掉，那么sleepimage就永远都不会出现了。但是不知道为什么，LZ每次删掉后它都会重新出现，所以就想出这么一个招去对付它。

LZ遇到的问题可能是因为手动更改hibernatemode后跟系统原有的其他电源设置有冲突，所以无法进入睡眠模式导致耗电巨大

也有可能是因为系统睡眠一段时间后自动进入休眠，而休眠也需要写入内存镜像，但是sleepimage又被锁住了，所以就无法休眠，Mac就一直处于工作状态，尝试写入内存镜像，导致睡眠一晚上耗电巨大。



我们也可以关掉自动休眠，后面会说到。


这样就把睡眠模式改成0了，同时也释放了内存镜像占用的SSD空间。




如果改了睡眠模式之后你没有遇到跟LZ一样的问题，那么恭喜你，你不用往下看了。
但是如果你很悲剧，RP不好，遇到跟LZ一样的睡眠耗电问题，那么也恭喜你，因为LZ已经找到办法解决了，请继续往下看。


既然是因为手动修改睡眠模式后跟系统的其他电源设置冲突，或者因为sleepimage锁定，造成Mac无法进入睡眠模式，那么我们把互相冲突的设置改成不冲突就行了。


首先，看看系统的电源设置都是些什么


在终端输入：pmset -g custom    这个命令可以显示系统所有的电源设置，如下图





Battery Power就是用电池时的电源设置，AC Power就是外接电源时的电源设置。
这里也可确认下你成功更改hibernatemode没有，后面那个数字就是睡眠模式了。


简单介绍下pmset下面各个参数的含义，不同型号的Mac看到的参数会不一样，LZ这个是2013款13寸高配Air，更详细的介绍请看Apple开发者文档


lidwake: 当屏幕掀开的时候唤醒Mac，1是开启  0是关闭
autopoweroff: 如果Mac处于睡眠状态经过指定的时间后，自动把内存数据写入硬盘，并切断所有部件的电源，进入休眠状态，1是开启  0是关闭。但是LZ发现就算是处于开启状态，这个功能也并没有起作用，你可以不管它，也可以关掉
autopoweroffdelay:启用autopoweroff功能的时间，也就是上面说的那个“指定的时间”，单位是秒
standby:功能跟autopoweroff一样，不过仅在hibernatemode为3的时候起作用，1是开启 0是关闭。不过LZ一直没搞明白autopoweroff跟standby有什么不一样，按理说应该是不一样的
standbydelay:启用standby功能的时间，单位也是秒
ttyskeepawake:远程用户正在活动时防止Mac进入睡眠，1是开启  0是关闭
hibernatemode:睡眠模式
darkwakes:这个就是Power Nap，你可以在系统偏好设置里选择开或关，跟在这里设置是一样的，1是开启  0是关闭
hibernatefile:内存镜像存放的地址，这个也可以更改，不过路径必需是root下的路径
displaysleep:Mac闲置多长时间后进入显示器睡眠，2013款Air的系统偏好设置里已经没有这个选项了，Pro是有的，不过其实你可以通过pmset来修改。单位是分钟，这个时间不能长于sleep下设置的时间
sleep:Mac闲置多长时间后进入睡眠，这个系统偏好设置里也有，单位是分钟
acwake:电源改变时唤醒，也就是插上或者拔掉外置电源时唤醒Mac，1是开启  0是关闭
halfdim:显示器睡眠时使显示器亮度改变为当前亮度的一半，1是开启  0是关闭。如果关闭这个功能的话，显示器睡眠会直接关掉显示器。
lessbright:使用电池时使显示器亮度暗一点，系统偏好设置里也有这个，1是开启  0是关闭
disksleep:Mac闲置多长时间后关闭硬盘。这个系统偏好里也有，只不过换了一个字眼—如果可能，使硬盘进入睡眠—勾上这个的话系统就会自动根据sleep的时间设一个合适的时间。单位是秒，这个时间不能长于sleep下设置的时间
sleepservice:LZ还没搞清楚这个是干嘛的，请知道的锋友解释下。
womp:网络远程唤醒，1是开启  0是关闭
networksleep:这个设置影响Mac在睡眠的过程中如何提供网络共享服务，LZ也不太清楚是什么，最好就不要动。


不同的Mac的pmset项目会不一样，例如MD101就没有darkwakes这一项，这篇帖子里LZ用的是2013款Air为例子。你可以在终端输入pmset -g cap查看当前电源下Mac支持的电源设置项。



上面说了那么多，各位锋友应该也猜到怎么解决Air睡眠耗电、无法唤醒、无法睡眠之类的问题了吧，关键是autopoweroff    standby   sleep   disksleep   displaysleep这几项。

首先，时间设置上，应该是sleep>=disksleep>=displaysleep，例如分别设置为15 15 10，否则就可能出问题

然后autopoweroff  standby建议关闭，或者设置一个比默认更长的时间，让Mac不可能有机会进入自动休眠，就可以防止睡眠经过几个小时就自动进入休眠需要写入sleepimage，但是又因为锁定无法写入，消耗电量。

当然，如果你没有动sleepimage，或者需要这项功能的话，你可以不用关闭autopoweroff和standby。

这样应该就可以解决Air睡眠遇到的问题了



要更改某一项设置的话也很简单，打开终端，按下面的格式输入命令：


sudo pmset -# $ &


其中#号有4个参数，分别是：c   b    u    a，作用是表明这个命令修改的是哪个电源设置下的参数。c代表外接电源、b代表电池、u代表UPS、a代表所有电源。


$就是具体的某一项参数，例如你想修改睡眠模式，那就是hibernatemode；修改睡眠闲置时间，是sleep。


&是参数的值


例如你想修改外接电源是Mac的显示器睡眠闲置时间为10分钟，那就输入：


sudo pmset -c displaysleep 10




想修更改所有电源下的硬盘睡眠闲置时间为15分钟，那就是：


sudo pmset -a disksleep 15




明白了吧，其实上面说了一大堆，到头来是非常简单的事。如果不清楚该设置成什么参数，可以参考图中LZ自己设置的数值。




最后提醒一句，更改系统底层设置有风险，LZ仅在2013款13寸Air顶配和2012款13寸普屏MacBook Pro  MD101上测试过以上内容，其他型号的Mac如果按此帖更改电源设置，请做好数据备份，遇到任何问题LZ均不负责，后果自负！！

欢迎转载此贴，如需转载无需告知LZ，但请在转载中注明原帖地址和作者，谢谢！
