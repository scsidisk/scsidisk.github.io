<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="scsidisk" />
    <title>linux ssh 无密码登陆 | scsidisk</title>
    <link href="/feed/" rel="alternate" title="scsidisk" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/css/highlight.css">
    <link href='/media/webfonts/ss-social.css' rel='stylesheet'>
    <link href='/media/webfonts/ss-standard.css' rel='stylesheet'>
    <link href="/media/css/screen.css" rel="stylesheet">

    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <div class="buttons">
          <a href="/" class="ss-icon" title="Go to homepage">home</a>
          <a href="/categories" class="ss-icon" title="Category" >list</a>
          <a href="/tags" class="ss-icon" title="Tag Cloud" >tags</a>
          <a href="/guestbook" class="ss-icon" title="Guest Book" >talk</a>
          <a href="/about" class="ss-icon" title="About" >user</a>
          <a href="/feed" class="ss-icon" title="Subscribe by RSS" >rss</a>
        </div>
        <h1>linux ssh 无密码登陆</h1>
        </header>
        <hr>
        <article class="content">
        <section class="post">
<p>ssh 无需密码登陆</p>

<p>ssh-keygen -t rsa 会创建\~/.ssh/id-ras.pub id-ras</p>

<p>公钥：/root/.ssh/id-ras.pub</p>

<p>私钥：/root/.ssh/id-ras</p>

<p>chmod 755 /root/.ssh (可不做)</p>

<p>把公钥复制到需要访问的机器上 /.ssh/ 并改名保存为 authorized_keys
,如果是多台机器需要,无密码登陆,则各自机器产生公钥追加到authorized_keys即可.</p>

<p>假设服务器IP地址为192.168.1.1，机器名：cluster.hpc.org</p>

<p>客户端IP地址为172.16.16.1，机器名：p470-2.wangrx.sioc.ac.cn</p>

<p>客户端用户yzhao需要使用ssh无密码登录服务器的zhaoy帐户</p>

<p>实现原理</p>

<p>使用一种被称为"公私钥"认证的方式来进行ssh登录.
"公私钥"认证方式简单的解释是</p>

<p>首先在客户端上创建一对公私钥 （公钥文件：\~/.ssh/id_rsa.pub；
私钥文件：\~/.ssh/id_rsa）</p>

<p>然后把公钥放到服务器上（\~/.ssh/authorized_keys）, 自己保留好私钥</p>

<p>当ssh登录时,ssh程序会发送私钥去和服务器上的公钥做匹配.如果匹配成功就可以登录了</p>

<p>设置如下：</p>

<p>1、以yzhao用户登录客户机器并在客户端机器上执行"ssh-keygen -t rsa"</p>

<p>(注：每次执行"ssh-keygen -t rsa"产生的私钥文件都会不同)</p>

<p>a）如果文件"\~/.ssh/id_rsa"存在，会提示是否覆盖该文件，此时可选择"n"不覆盖该文件而使用已有的id_rsa文件；如果选择"y"则会重新生成"\~/.ssh/id_rsa"文件，接下来会提示输入passphrase，回车确定使用空的passphrase，再次回车确认（这里也可以输出passphrase，相当于ssh时登录的密码）。然后会重新生成"\~/.ssh/id_rsa"文件和"\~/.ssh/id_rsa.pub"文件（结果如下）。</p>

<p>[yzhao@p470-2 \~]\$ ssh-keygen -t rsa</p>

<p>Generating public/private rsa key pair.</p>

<p>Enter file in which to save the key (/disk2/yzhao/.ssh/id_rsa):</p>

<p>/disk2/yzhao/.ssh/id_rsa already exists.</p>

<p>Overwrite (y/n)? y</p>

<p>Enter passphrase (empty for no passphrase):</p>

<p>Enter same passphrase again:</p>

<p>Your identification has been saved in /disk2/yzhao/.ssh/id_rsa.</p>

<p>Your public key has been saved in /disk2/yzhao/.ssh/id_rsa.pub.</p>

<p>The key fingerprint is:</p>

<p>6d:a1:17:8a:b6:d2:c0:a1:6c:66:ba:85:0b:7b:9f:0c
yzhao@p470-2.wangrx.sioc.ac.cn</p>

<p>b）如果"\~/.ssh/id_rsa"文件和"\~/.ssh/id_rsa.pub"文件不存在则会自动创建新的"\~/.ssh/id_rsa"文件和"\~/.ssh/id_rsa.pub"文件，passphrase设置同上。</p>

<p>[yzhao@p470-2 \~]\$ ssh-keygen -t rsa</p>

<p>Generating public/private rsa key pair.</p>

<p>Enter file in which to save the key (/disk2/yzhao/.ssh/id_rsa):</p>

<p>Created directory '/disk2/yzhao/.ssh'.</p>

<p>Enter passphrase (empty for no passphrase):</p>

<p>Enter same passphrase again:</p>

<p>Your identification has been saved in /disk2/yzhao/.ssh/id_rsa.</p>

<p>Your public key has been saved in /disk2/yzhao/.ssh/id_rsa.pub.</p>

<p>The key fingerprint is:</p>

<p>54:49:ad:33:b3:ff:71:da:6d:db:78:d0:bb:6a:15:bc
yzhao@p470-2.wangrx.sioc.ac.cn</p>

<p>2、使用ssh
zhaoy@192.168.1.1登录到服务器，编辑服务器上"\~/.ssh/authorized_keys"文件，将客户端机器上的"\~/.ssh/id_rsa.pub"文件内容追加到"\~/.ssh/authorized_keys"文件中。</p>

<p>（注：可以在客户端机器上使用以下命令来实现：</p>

<p>cat \~/.ssh/id_rsa.pub | ssh zhaoy@192.168.1.1 "cat - >>
\~/.ssh/authorized_keys"</p>

<p>此时会要求输入zhaoy在服务器上的登录密码，输入后即会将客户端机器上的"\~/.ssh/id_rsa.pub"文件内容追加到服务器上的"\~/.ssh/authorized_keys"文件中）</p>

<p>如果是首次连接服务器会出现以下的提示，确认连接并输入密码后其他直接回车确定。</p>

<p>[yzhao@p470-2 \~]\$ ssh zhaoy@192.168.1.1</p>

<p>The authenticity of host '192.168.1.1 (192.168.1.1)' can't be
established.</p>

<p>RSA key fingerprint is 94:91:33:01:6b:e7:10:ae:42:ac:ea:5c:8c:bb:f1:18.</p>

<p>Are you sure you want to continue connecting (yes/no)? yes</p>

<p>Warning: Permanently added '192.168.1.1' (RSA) to the list of known
hosts.</p>

<p>zhaoy@192.168.1.1's password:</p>

<p>Last login: Fri Dec 21 17:41:38 2007 from 172.16.16.1</p>

<p>Rocks 4.2.1 (Cydonia)</p>

<p>Profile built 03:58 21-Jun-2007</p>

<p>Kickstarted 12:25 21-Jun-2007</p>

<p>Rocks Frontend Node - Our Cluster Cluster</p>

<p>It doesn't appear that you have set up your ssh key.</p>

<p>This process will make the files:</p>

<p>/home/zhaoy/.ssh/id_rsa.pub</p>

<p>/home/zhaoy/.ssh/id_rsa</p>

<p>/home/zhaoy/.ssh/authorized_keys</p>

<p>Generating public/private rsa key pair.</p>

<p>Enter file in which to save the key (/home/zhaoy/.ssh/id_rsa):</p>

<p>Created directory '/home/zhaoy/.ssh'.</p>

<p>Enter passphrase (empty for no passphrase):</p>

<p>Enter same passphrase again:</p>

<p>Your identification has been saved in /home/zhaoy/.ssh/id_rsa.</p>

<p>Your public key has been saved in /home/zhaoy/.ssh/id_rsa.pub.</p>

<p>The key fingerprint is:</p>

<p>7e:f6:ab:b0:79:70:cb:c9:f7:40:37:aa:10:4d:4a:ac zhaoy@cluster.hpc.org</p>

<p>3、如果在第1步中使用了空的passphrase，则可以跳过第4步，此时在客户端即可以使用"ssh
zhaoy@192.168.1.1"即可无密码登录到服务器；如果第一步中设置了passphrase，则继续执行以下步骤。</p>

<p>4、如果第1步中设置了passphrase，则此时需要输入该passphrase登录服务器。此时前面我们把输入密码变成了输入passphrase，这没有带来任何方便。但是我们可以通过ssh-agent来帮助我们自动输入passphrase(只是看起来像是自动输入而已)，我们只要在第一次登录时输入一次passphrase,
以后的工作就可以交给ssh-agent。在客户端机器上执行命令ssh-add，这里会提示输入一次passphrase。输入第一步中设置的passphrase之后会修改"\~/.ssh/id_rsa"文件。再在客户端执行"ssh
zhaoy@192.168.1.1"即可无密码登录到服务器端。</p>

<p>[yzhao@p470-2 \~]\$ ssh-add</p>

<p>Enter passphrase for /disk2/yzhao/.ssh/id_rsa:</p>

<p>Identity added: /disk2/yzhao/.ssh/id_rsa (/disk2/yzhao/.ssh/id_rsa)</p>

<p>[yzhao@p470-2 \~]\$ ssh zhaoy@192.168.1.1</p>

<p>Last login: Fri Dec 21 17:55:38 2007 from 172.16.16.1</p>

<p>Rocks 4.2.1 (Cydonia)</p>

<p>Profile built 03:58 21-Jun-2007</p>

<p>Kickstarted 12:25 21-Jun-2007</p>

<p>Rocks Frontend Node - Our Cluster Cluster</p>

<p>[zhaoy@cluster \~]\$</p>

<div class="posttagsblock">
</div>




</section>
<section class="meta">
<span class="author">
  <a href="http://scsidisk.github.io">scsidisk</a>
</span>
<span class="time">
  /
  <time datetime="2010-12-28">2010-12-28</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/categories/#centos" title="centos">centos</a>&nbsp;
  
</span>


<span class="tags">
  tagged with
  
  <a href="/tags/#CentOS," title="CentOS,">CentOS,</a>&nbsp;
  
  <a href="/tags/#Linux," title="Linux,">Linux,</a>&nbsp;
  
  <a href="/tags/#SSH" title="SSH">SSH</a>&nbsp;
  
</span>

</section>
<section class="comment">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'scsidiskgithuio'; // required: replace example with your forum shortname
    var disqus_url = 'http://scsidisk.github.io/2010/12/linux_ssh_login_no_password/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://scsidisk.github.io/2010/12/linux_config_ssh_port_to_disable_root_remote_login/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://scsidisk.github.io/2010/12/several_methods_of_automatic_ssh_login/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> | Copyright 2008 - 2014 by <a href="http://scsidisk.github.io">scsidisk</a> | <span class="label label-info">2014-06-10 02:55:09 CST</span></small></p>
    </footer>

    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', '');
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
