<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="scsidisk" />
    <title>Mac配置docbook工具链 | scsidisk</title>
    <link href="/feed/" rel="alternate" title="scsidisk" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/css/highlight.css">
    <link href='/media/webfonts/ss-social.css' rel='stylesheet'>
    <link href='/media/webfonts/ss-standard.css' rel='stylesheet'>
    <link href="/media/css/screen.css" rel="stylesheet">

    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <div class="buttons">
          <a href="/" class="ss-icon" title="Go to homepage">home</a>
          <a href="/categories" class="ss-icon" title="Category" >list</a>
          <a href="/tags" class="ss-icon" title="Tag Cloud" >tags</a>
          <a href="/guestbook" class="ss-icon" title="Guest Book" >talk</a>
          <a href="/about" class="ss-icon" title="About" >user</a>
          <a href="/feed" class="ss-icon" title="Subscribe by RSS" >rss</a>
        </div>
        <h1>Mac配置docbook工具链</h1>
        </header>
        <hr>
        <article class="content">
        <section class="post">
<h1>Mac配置docbook工具链</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>docbook是一种在开源界极其流行的文档撰写格式，其源文件可以方便的转换为html，pdf等各种格式。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="">安装工具链</h2>
<div class="sectionbody">
<div class="paragraph">
<p>docbook工具链包含三部分</p>
</div>
<div class="ulist">
<ul>
<li>
<p>xsltproc (mac自带)</p>
</li>
<li>
<p>docbook-xsl (需要下载解压 wget <a href="http://downloads.sourceforge.net/project/docbook/docbook-xsl/1.76.1/docbook-xsl-1.76.1.tar.bz2)">http://downloads.sourceforge.net/project/docbook/docbook-xsl/1.76.1/docbook-xsl-1.76.1.tar.bz2)</a></p>
</li>
<li>
<p>fop (到http://www.apache.org/dyn/closer.cgi/xmlgraphics/fop下载)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下载解压后得到：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docbook-xsl-1.76.1
fop-1.0</pre>
</div>
</div>
<div class="paragraph">
<p>两个目录。</p>
</div>
<div class="paragraph">
<p>此时可以已经可以进行docbook撰写了，不过只限英文:)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docbook-pdf">撰写docbook，并生成pdf</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用文本编辑器编写如下xml，保存为webx.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.0//EN" "http://www.oasis-open.org/docbook/xml/4.0/docbookx.dtd"&gt;
&lt;book&gt;
	&lt;bookinfo&gt;
		&lt;title&gt;Webx Source Code&lt;/title&gt;
		&lt;author&gt;
			&lt;firstname&gt;Bo&lt;/firstname&gt;
			&lt;surname&gt;Jiang&lt;/surname&gt;
			&lt;affiliation&gt;
				&lt;address&gt;
					&lt;email&gt;jiang.bo.hit@gmail.com&lt;/email&gt;
				&lt;/address&gt;
			&lt;/affiliation&gt;
		&lt;/author&gt;
		&lt;copyright&gt;
			&lt;year&gt;2011&lt;/year&gt;
		&lt;/copyright&gt;
		&lt;abstract&gt;
			&lt;para&gt;Webx&lt;/para&gt;
		&lt;/abstract&gt;
	&lt;/bookinfo&gt;
	&lt;part&gt;
		&lt;title&gt;Part1&lt;/title&gt;
		&lt;chapter&gt;
			&lt;title&gt;Chapter 1 &lt;/title&gt;
			&lt;sect1&gt;
				&lt;title&gt;Part1, Chapter 1, Section1&lt;/title&gt;
				&lt;para&gt; Your Text &lt;/para&gt;
			&lt;/sect1&gt;
		&lt;/chapter&gt;
		&lt;chapter&gt;
			&lt;title&gt;Part 1, Chapter 2&lt;/title&gt;
			&lt;sect1&gt;
				&lt;title&gt;Part1, Chapter 2, Section 1&lt;/title&gt;
				&lt;para&gt; Your Text &lt;/para&gt;
			&lt;/sect1&gt;
		&lt;/chapter&gt;
	&lt;/part&gt;
&lt;/book&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>使用xsltproc转换为中间文件</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$xsltproc -o inter.fo ~/tools/docbook-xsl-1.76.1/fo/docbook.xsl webx.xml</pre>
</div>
</div>
<div class="paragraph">
<p>此时会生成中间文件inter.fo</p>
</div>
<div class="paragraph">
<p>使用fop生成pdf</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$~/tools/fop-1.0/fop -pdf webx.pdf -fo inter.fo 最终生成了名为webx.pdf的pdf文件</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fop">设置FOP支持中文</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用FOP默认的配置处理含有中文的文档是，中文都会变成# :(，原因是FOP默认不支持中文字体，需要自己配置一下。</p>
</div>
<div class="paragraph">
<p>找到自己系统中的字体目录，Mac下为/Library/Fonts，里面存在Microsoft/SimHei.ttf字体文件，下面一该字体为例生成一个FOP字体矩阵配置。</p>
</div>
<div class="sect2">
<h3 id="-2">生成字体矩阵</h3>
<div class="paragraph">
<p>进入到fop安装目录，执行</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ java -cp build/fop.jar:`echo lib/*.jar |tr ' ' ':'` org.apache.fop.fonts.apps.TTFReader \
-ttcanme "SimHei" /Library/Fonts/Microsoft/SimHei.ttf conf/simhei.xml</pre>
</div>
</div>
<div class="paragraph">
<p>会在conf目录下生成simhei.xml字体矩阵文件</p>
</div>
</div>
<div class="sect2">
<h3 id="fop-conf-fop-xconf">修改fop配置文件conf/fop.xconf，加入如下配置</h3>
<div class="listingblock">
<div class="content">
<pre>&lt;renderer mime="application/pdf"&gt;
&lt;filterList&gt;
……
&lt;/filterList&gt;
&lt;fonts&gt;
	&lt;font metrics-url="file:///Users/jiangbo/tools/fop-1.0/conf/simhei.xml" kerning="yes" embed-url="file:///Library/Fonts/Microsoft/SimHei.ttf"&gt;
		&lt;font-triplet name="SimHei" style="normal" weight="bold"/&gt;
		&lt;font-triplet name="SimHei" style="normal" weight="bold"/&gt;
	&lt;/font&gt;
	&lt;!--&lt;directory recursive="true"&gt;/Library/Fonts/&lt;/directory&gt;--&gt;
	&lt;!-- &lt;auto-detect/&gt;--&gt;
&lt;/fonts&gt;
……</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docbook-docbook-xsl">撰写docbook样式表，docbook.xsl</h3>
<div class="paragraph">
<p>默认转换时使用的是docbook-xsl-1.76.1/fo/docbook.xsl样式表，该样式表中不包括中文字体，需要自定义一个样式表docbook.xsl</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version='1.0'?&gt;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:exsl="http://exslt.org/common"
                xmlns:fo="http://www.w3.org/1999/XSL/Format"
                xmlns:ng="http://docbook.org/docbook-ng"
                xmlns:db="http://docbook.org/ns/docbook"
                exclude-result-prefixes="db ng exsl"
                version='1.0'&gt;
&lt;xsl:import href="/Users/jiangbo/tools/docbook-xsl-1.76.1/fo/docbook.xsl"/&gt;
&lt;xsl:param name="body.font.family"&gt;SimHei&lt;/xsl:param&gt;
&lt;xsl:param name="monospace.font.family"&gt;SimHei&lt;/xsl:param&gt;
&lt;xsl:param name="title.font.family"&gt;SimHei&lt;/xsl:param&gt;
&lt;/xsl:stylesheet&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="-3">使用新样式表进行转换</h3>
<div class="literalblock">
<div class="content">
<pre>$ xsltproc -o inter.fo docbook.xsl webx.xml</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ~/tools/fop-1.0/fop -c  ~/tools/fop-1.0/conf/fop.xconf -pdf webx.pdf -fo inter.fo</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="meta">
<span class="author">
  <a href="http://scsidisk.github.io">scsidisk</a>
</span>
<span class="time">
  /
  <time datetime="2013-05-10">2013-05-10</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
</span>


<span class="tags">
  tagged with
  
</span>

</section>
<section class="comment">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'scsidiskgithuio'; // required: replace example with your forum shortname
    var disqus_url = 'http://scsidisk.github.io/2013/05/setting_toolchains_of_docbook_on_mac/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://scsidisk.github.io/2013/05/mnpp_mac_nginx_percona_php_python/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://scsidisk.github.io/2013/05/use_homebrew_to_install_the_specified_version_of_the_tool/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> | Copyright 2008 - 2014 by <a href="http://scsidisk.github.io">scsidisk</a> | <span class="label label-info">2014-06-10 02:48:30 CST</span></small></p>
    </footer>

    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', '');
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
